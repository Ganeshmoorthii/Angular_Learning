<div class="register-container container mt-5 p-4 border rounded">
  <h1 class="register-title">{{ isEditMode ? 'Edit User' : 'Register' }}</h1>
  <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
    <div class="form-row">
      <div class="mb-3">
        <label for="validationDefault01">Full name</label>
        <input
          type="text"
          class="form-control"
          id="validationDefault01"
          placeholder="Full name"
          formControlName="fullName"
        />
        @if (
          registerForm.get("fullName")?.hasError("required") &&
          registerForm.get("fullName")?.touched
        ) {
          <span class="text-danger">Full name is required</span>
        }
      </div>
      <div class="mb-3">
        <label for="validationDefaultUsername">Email</label>
        <div class="input-group">
          <input
            type="text"
            class="form-control"
            id="validationDefaultUsername"
            placeholder="Email"
            aria-describedby="inputGroupPrepend2"
            formControlName="email"
          />
        </div>
        @if (
          registerForm.get("email")?.hasError("required") &&
          registerForm.get("email")?.touched
        ) {
          <span class="text-danger">Email is required</span>
        }
      </div>
      <div class="mb-3">
        <label for="validationDefaultUsername">Password</label>
        <div class="input-group">
          <input
            type="password"
            class="form-control"
            id="validationDefaultPassword"
            placeholder="Password"
            aria-describedby="inputGroupPrepend2"
            formControlName="password"
          />
        </div>
        @if (
          registerForm.get("password")?.invalid &&
          registerForm.get("password")?.touched
        ) {
          @if (registerForm.get("password")?.hasError("required")) {
            <span class="text-danger">Password is required</span>
          }
          @if (getFailedRequirements().length > 0) {
            <small class="text-danger d-block mt-1">
              Password must contain:<br />
              @for (req of getFailedRequirements(); track $index) {
                â€¢ {{ req }}<br />
              }
            </small>
          }
        }
      </div>
      <div class="mb-3">
        <label for="inputGroupSelect01">Choose Role</label>
        <select
          class="form-select"
          id="inputGroupSelect01"
          formControlName="role"
        >
          <option value="Admin">Admin</option>
          <option value="Reviewer">Reviewer</option>
          <option value="Auditor">Auditor</option>
        </select>
        @if (
          registerForm.get("role")?.hasError("required") &&
          registerForm.get("role")?.touched
        ) {
          <span class="text-danger">Role is required</span>
        }
      </div>
      <div class="col-md-12 mb-3">
        <label>Contact Numbers</label>
        <div formArrayName="contactNumbers">
          @for (
            control of contactNumbers.controls;
            track $index;
            let i = $index
          ) {
            <div class="input-group mb-2">
              <input
                type="text"
                class="form-control"
                placeholder="Contact Number"
                [formControlName]="i"
              />
              <button
                type="button"
                class="btn btn-outline-danger"
                (click)="removeContactNumber(i)"
              >
                Remove
              </button>
            </div>
            @if (control.hasError("required") && control.touched) {
              <small class="text-danger">Phone number is required</small>
            }
            @if (control.hasError("pattern") && control.touched) {
              <small class="text-danger"
                >Phone number must be exactly 10 digits</small
              >
            }
          }
        </div>
        <button
          type="button"
          class="btn btn-outline-primary mt-2"
          (click)="addContactNumber()"
        >
          Add Contact Number
        </button>
      </div>
    </div>

    <div class="form-group">
      <div class="form-check">
        <input
          class="form-check-input"
          type="checkbox"
          id="invalidCheck2"
          formControlName="agreeTerms"
        />
        <label class="form-check-label" for="invalidCheck2">
          Agree to terms and conditions
        </label>
      </div>
      @if (
        registerForm.get("agreeTerms")?.hasError("requiredTrue") &&
        registerForm.get("agreeTerms")?.touched
      ) {
        <span class="text-danger">You must agree before submitting.</span>
      }
    </div>
    <div class="d-flex gap-2">
      <button
        class="btn btn-primary"
        type="submit"
        [disabled]="registerForm.invalid"
      >
        {{ isEditMode ? 'Update' : 'Register' }}
      </button>
      @if (isEditMode) {
        <button
          type="button"
          class="btn btn-secondary"
          (click)="closeDialog()"
        >
          Cancel
        </button>
      }
    </div>
  </form>
</div>
